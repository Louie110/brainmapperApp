<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <meta name="AppleIcon" content="BRMIcon_16x16.png"/>
        <meta name="AppleTitle" content="BrainMapper Help"/>
        <meta name="description" content="Coregistering electrode locations with MRI/CT imaging."/>
        <title>BrainMapper Help</title>
    </head>
    <body>
        
        <h1 align="center">BrainMapper Application</h1>
        <p align="center">Version 2.6</p>
        <p align="center"> &copy;2014, University of Pennsylvania </p>
        
        
        <p> The BrainMapper application provides a user-friendly interface to create 3D reconstructions of subdural electrodes on a parcellated brain with rich cortical annotation.  This software is distributed under the General Public License (http://opensource.org/licenses/gpl-3.0.html).
        
        <p> <b>(1) Any results using this package should include a citation to the following publication:</b><br>
        
        Allan A. Azarion<sup>†</sup>, Jue Wu<sup>†</sup>, Kathryn A. Davis, Allison Pearce, Veena T. Krish, Joost Wagenaar, Weixuan Chen,
            Yuanjie Zheng, Hongzhi Wang, Timothy H. Lucas, Brian Litt,<sup>‡</sup> and James C. Gee.<sup>‡</sup> An open-source automated platform for three-dimensional visualization of subdural electrodes using CT-MRI coregistration. <i>Epilepsia</i> 2014, in press.</p>
            
        <p><sup>†</sup>Co-first authors; contributed equally to this article, <sup>‡</sup>Co-senior authors; contributed equally to this article</p>
        
        <p> <b>(2) Screenshots of the 3D coregistered images using ITK-SNAP should include a citation to the following publication:</b><br>
        Paul A. Yushkevich, Joseph Piven, Heather C. Hazlett, Rachel G. Smith, Sean Ho, James C. Gee, and
        Guido Gerig. User-guided 3D active contour segmentation of anatomical structures: Significantly
        improved efficiency and reliability. <i>Neuroimage</i> 2006 Jul 1;31(3):1116-28.</p>
        
        <h3> Included packages</h3>
        <p> This package contains many components of open-source software that are provided subject to the terms of their licenses. For more information about individual components, please see the relevant documentation and visit the original developers’ websites below:
        </p>
        
        <p>ANTs Home Page: http://www.picsl.upenn.edu/ANTS/<br>
        FSL License: http://www.fmrib.ox.ac.uk/fsl/fsl/licence.html<br>
        FSL Home Page: http://www.fmrib.ox.ac.uk/fsl/index.html<br>
        ITK-SNAP General Public License: http://www.gnu.org/licenses/gpl-3.0.txt<br>
        ITK-SNAP Home Page: http://www.itksnap.org/pmwiki/pmwiki.php<br>
        MRIcron License: http://www.mccauslandcenter.sc.edu/mricro/mricron/install.html<br>
        MRIcron dcm2nii Home Page: http://www.mccauslandcenter.sc.edu/mricro/mricron/dcm2nii.html</p>
        
        <p>The BrainMapper application is constantly being updated. Please visit the International Epilepsy and Electrophysiology Portal (https://www.ieeg.org) to download the latest version.
        </p>
        
        <h2> Using the BrainMapper application</h2>
        <p>Images from the post-implant CT and either the T1 pre-implant MRI or T1 post-implant MRI are to be loaded into the application in DICOM (.dcm) format. You may need a DICOM viewer such as Osirix (http://www.osirix-viewer.com/) to extract the images from a disk to your computer and export them as DICOMs. If you have multiple studies for the same patient, using the one with the most images will produce the highest resolution reconstruction.
        </p>
        
        <p>
        <ol>
            <li>Select your preferred destination folder for the final images by double-clicking on the bar in the first box and dragging your created folder onto the bar. </li>
            <li>If you would like a labeled, segmented image, click the Segmentation box.   This will output the parcellated brain with different colors of the cortices that are approximate boundaries of functional anatomy. Note that this will significantly increase the processing time.</li>
            <li>Load your images by dragging one DICOM file of each type onto the bar in the third box.   The application will search through the parent folders of each image to upload all of the images.  Make sure that all images of each type are in the same folder with no other files, and that the CT and MR images are in separate folders.</li>
            <li>Click "Start" to run.  The running time is approximately 20 minutes for CT-MR coregistration (monochrome brain, without segmentation), and approximately 3 hours for brain parcellation.  The running time for parcellation may sometimes be 10-20 hours in cases of low available RAM, or with very high in-plane resolution of the source MRI images.</li>
            <li>The final images will appear in the destination folder as the following: mri_brain.nii.gz, unburied_electrode_seg.nii.gz, and unburied_electrode_aligned.nii.gz.  </li>
        </ol>
        </p>
        
        <h3>Viewing the reconstructed images</h3>
        <p>You will need to load the produced nifti images into a 3D Viewer, such as ITK-SNAP (http://www.itksnap.org/pmwiki/pmwiki.php). </p>
        <p>To load images into the ITK-SNAP 3.0: </p>
        <p>
        <ol>
            <li>Load the brain image by going to File → "Open Image…” and selecting the output file mri_brain.nii.gz.  The image file format must be selected as NiFTI.</li>
            <li>Load the electrode placement image by going to "Segmentation” → "Open Segmentation" and selecting the output file unburied_electrode_seg.nii.gz.  The image file format must be selected as NiFTI. </li>
            <li> Load the cortical labels for parcellated images by going to "Segmentation" → "Import Label Descriptions" and selecting the output file Cortical_Labels.txt.</li>
        </ol>
        </p>
        
        <h3>Using ITK-SNAP to view the images</h3>
        <p>Once the images are loaded, you will need to generate the 3D image by clicking on "update” at the bottom-left corner of the blank quarter-window (The other 3 quarter-windows will show 2D slices of the reconstruction).  The reconstructed surface rendering can easily be navigated in 3D space. </p>
        <p>Other useful tools for viewing the reconstructed images are as follows:
        <ul>
            <li>Label Editor:  This tool allows for color adjustment of the electrodes and cortical regions.  </li>
            <li>Crosshairs:  This tool allows for navigation through the 2D windows. Actions can be linked across multiple ITK-SNAP windows. </li>
            <li>Going to "Tools" → "Image Information" → "Info" displays the voxel size of the source MR image.   If the voxels of the T1 MR images are highly anisotropic, then the out-of-plane resolution will be worse than the in-plane resolution, resulting in a choppy, step-like effect in the anterior and posterior sections of the final 3D image.  It is recommended that the T1 MR images have isotropic voxels.  The T1 MRI voxel size in the X-Y-Z plane for the subjects in the original study was 1 mm x 1 mm x 1 mm.</li>
        </ul>
        </p>
        
        <h3>Contact email for troubleshooting</h3>
        <p>ieegportal@gmail.com</p>
        
    </body>
</html>